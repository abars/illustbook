<script language="javascript" src="{{host}}js/jquery/jquery.alerts.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" media="screen,print" href="{{host}}js/jquery/jquery.alerts.css" />

<script type="text/javascript">
	function require_password(key,viewmode,pass){
		jPrompt("ルームのパスワードを入力して下さい","","パスワードの入力",function(pass){
			if(pass){
				require_username(key,viewmode,pass);
			}
		});
	}

	function require_username(key,viewmode,pass){
		{% if not user %}
			jPrompt("チャットで使用する名前を入力して下さい","{{user_name}}","名前の入力",function(name){
				if(name){
					start_chat(key,viewmode,pass,name);
				}
			});
		{% else %}
			start_chat(key,viewmode,pass,"{{user_name}}");
		{% endif %}
	}

	function start_chat(key,viewmode,pass,name){
		window.location.href="./chat?mode=tool&amp;key="+key+"&amp;viewmode="+viewmode+"&amp;name="+name+"&amp;pass="+pass
	}

	function join_chat(key,viewmode,pass){
		if(pass!=""){
			require_password(key,viewmode,pass);
		}else{
			require_username(key,viewmode,pass);
		}
	}

	function delete_room(url){
		if(confirm("ルームを削除してもよろしいですか？")){
			window.location.href=url;
		}
	}

	function create_new_room(){
		$("#new_room").hide();
		$("#new_room_exec").show();
		document.new_room_form.submit();
	}
</script>

<!-- container -->
<div style="margin-left:4px;margin-right:4px;">

<div style="float:left;margin-right:10px;">
	<img src="./static_files/chat/logo.png" alt="logo"/>
</div>
<div style="float:left;">
	<h1>イラブチャットとは</h1>
	<p>イラブチャット（β）はPCとiPadで楽しめるお絵かきチャットです。<br/>
作成したイラストはイラストブックに投稿することができます。<br/>
ご利用にはHTML5に対応したブラウザが必要です。</p>
	<a href="chat?mode=tool&amp;key=always&amp;viewmode=false&amp;pass=false" class="g-button green">まずはお試し</a>
	<a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-hashtags="ilbchat">ツイート</a>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div>

<br clear="all"/>
<br clear="all"/>

<img src="./static_files/chat/ipad.png" alt="ipad"/>
<img src="./static_files/chat/bbs.png" alt="submitable"/>

<p>&nbsp;</p>

<h1>稼働中のルーム</h1>

{% if room_list %}
	{% for room in room_list %}
		<div style="float:left;">
			<a href="javascript:join_chat('{{room.key()}}',false,{% if room.password %}true{%else%}false{%endif%});" class="declink">
				{% if room.password %}
					<div style="width:160px;height:160px;"></div>
				{% else %}
					<img src="./chat?mode=thumbnail&amp;key={{room.key()}}" width="160px" height="160px" alt="room thumbnail"/>
				{% endif %}
			</a>
		</div>
		<div style="float:left;margin:4px;">
			<h2>{{room.name}}{% if room.is_always %}（常時稼動ルーム）{% endif %}
			{% if room.password %}
				（パスワードが必要）{% if user %}{% if user.user_id == room.user_id %}（{{room.password}}）{% endif %}{% endif %}　
			{% else %}
				（誰でも参加可能）
			{% endif %}
			</h2>
			<p>
				from <a href="./mypage?user_id={{room.user_id}}">{{room.user_name}}</a><br/>
				最終更新から{{room.from_last_update}}分経過<br/>
			</p>
			<div class="actions g-button-container">
				<div class="g-button-group">
					<a href="javascript:join_chat('{{room.key()}}',false,{% if room.password %}true{%else%}false{%endif%});" class="g-button green">{% if not is_iphone %}{% endif %}参加（{{room.user_count}}人）</a>
					{% if user %}{% if user.user_id() == room.user_id %}<a href="javascript:delete_room('./chat?mode=delete&amp;key={{room.key()}}');" class="g-button green">{% if not is_iphone %}{% endif %}削除</a>{% endif %}{% endif %}
				</div>
			</div>
		</div>
		<br clear="all"/>
	{% endfor %}
{% else %}
	<p>稼働中のルームはありません。</p>
{% endif %}

<br clear="all"/>

<h1>ルームの作成</h1>

<div id="new_room_exec" style="display:none;">
	<img src="./static_files/loading.gif" alt="loading"/>
	<br/>
	<p>ルームを作成しています。<br/>
	しばらくお待ち下さい。</p>
</div>

<div id="new_room">
	{% if not user %}
		<p>ルームの作成には<a href="{{redirect_url|login_url}}" class="declink">ログイン</a>が必要です。</p>
	{% else %}
	<form action="./chat" enctype="multipart/form-data" method="GET" name="new_room_form">
		<input type="hidden" name="mode" value="create">
		<table class="g-table">
		<tr><th>ルーム名（必須）</th><td><input type="text" name="name" style="width:200px"></td></tr>
		<tr><th>パスワード</th><td><input type="text" name="pass" style="width:200px">
		<br/>パスワードを設定しない場合は誰でも参加可能</td></tr>
		<tr><th>キャンバスサイズ</th><td>
			<select name="canvas_size">
			<option value="600x600">600x600px</option>
			<option value="800x600">800x600px</option>
			</select>
		</td></tr>
		</table>
		<br/>
		<a href="javascript:create_new_room();" class="g-button green">ルームを作成</a>
	</form>
	{% endif %}
</div>

<p>&nbsp;</p>
<h1>利用ガイド</h1>
<p>ルームは最終更新から10分が経過すると自動的に削除されます。<br/>
バグ報告や要望は<a href="./support/" class="declink">サポート掲示板</a>までどうぞ。<br/>
{% if is_admin %}管理者向け：パスワードにalwaysと入れると常時稼動ルームになります<br/>{% endif %}
</p>

<br/>

<!-- container -->
</div>